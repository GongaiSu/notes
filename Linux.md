# Liunx

## Linux目录结构

<span style='color:red'>在Linux中，一切皆文件！！！</span>

1. /bin [<span style='color:red'>常用</span>] (/usr/bin、/usr/local/bin):是Binary的缩写，这个目录存放这最常用使用的命令
2. /sbin (/usr/sbin 、/usr/local/sbin)：s是Super User的意思，这里存放的是系统管理员使用的系统管理程序。
3. /home [<span style='color:red'>常用</span>]：存放普通用户的主目录，在Linux中没一个用户都有一个自己的目录，一般改目录是以用户的账号命名。
4. /root [<span style='color:red'>常用</span>]:该目录为系统管理员，也称作超级权限者的用户主目录
5. /lib 系统开机所需要最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库
6. /lost+found 这个目录一般情况下是空的，当系统非法关机后，者里存放了一些文件
7. /etc [<span style='color:red'>常用</span>]:所有的系统管理所需要的配置文件和子目录，比如安装mysql数据库的my.conf
8. usr [<span style='color:red'>常用</span>]:这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下。
9. /boot [<span style='color:red'>常用</span>]:存放的是启动Linux时使用的一些核心文件，包括一些连接文件及镜像文件
10. /proc 这个目录时一个虚拟目录，它是系统内存的映射，访问这个目录来获取系统信息
11. /srv service缩写，改目录存放一些服务启动这后需要提取的数据
12. /sys 这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统sysfs
13. /tmp 这个目录是存放一些临时文件的
14. /dev 类似于windows的设备管理，把所有的硬件用文件的形式存储
15. /media [<span style='color:red'>常用</span>]：linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下
16. /mnt [<span style='color:red'>常用</span>]:系统提供该目录是为了让用户临时挂载别的文件系统的。我们可以将外部存储挂载在/mnt/上，然后进入该目录就可以查看里面的内容了。
17. /opt 这是给主机额外安装软件所 存放的目录。
18. /usr/local [<span style='color:red'>常用</span>]：这是另外一个给主机额外安装软件所安装的目录，一般是通过编译源码方式安装的程序
19. /var [<span style='color:red'>常用</span>] :这个目录中存放着不断扩充着的东西，习惯将经常被修改的目录放在这个目录下。包括各种日志文件
20. /selinux [security-enhanced linux]: SELinux是一种安全子系统，它能控制程序只能访问特定文件，有三种工作模式，可以自行设置。

## vi和vim的基本介绍

* 正常模式：以正常模式打开一个档案就直接进入一般模式了(默认)。在这个模式中，可以使用【上下左右】按键来移动光标，可以使用【删除字符】或【删除整行】来处理档案内容，也可以使用【复制、粘贴】来处理你的文件数据。
* 插入模式：按下i，I，o，O，a，A，r，R，等任何一个字母之后才会进入编辑模式，一般使用i即可。
* 命令行模式:输入ESC退出插入模式，在输入[:]进入该模式当中，可以使用相关命令，完成读取、存盘、替换、离开vim、显示行号等的动作则是在此模式中达成。

### 常用快捷键

1. 拷贝当前行 yy,拷贝当前行向下的5行 5yy，并粘贴(输入p)。
2. 删除当前行 dd，删除当前行向下的5行 5dd
3. 在文件中查找某个单词[命令模式下'/'关键字，回车 查找，输入n就是查找下一个]
4. 设置文件的行号，取消文件的行号。[命令行下 :set nu 和 :set nonu]
5. 在一般模式下，使用快捷键到该文档的最末行[G]和最首行[gg] 
6. 在一般模式下，使用快捷键[u]进行对之前的操作进行撤销
7. 将光标移动到对应的行号，在一般模式下，使用快捷键[行号 shift+g]

## 关机&重启命令

* shutdown -h now ：立刻进行关机
* shutdown -h 1 ：一分钟后关机
* shutdown -r now 立刻重启
* halt ：关机
* reboot ：重启
* sync : 把内存的数据同步到磁盘

## 用户登录和注销

* 在公司中尽量不要使用root账号登录，root是系统管理员，权限最大，避免操作失误，可以利用普通用户登录，登录之后在使用"su 用户名" 命令来切换成系统管理员身份
* 在提示符下输入logout即可注销用户。在图形运行级别无效，在运行级别3下有效。 

## 用户管理

### 添加用户

*  useradd 用户名 ：默认生成一个和用户名一样的家目录
  * useradd 用户名 -d 目录名 ：指定用户的位置

### 设置密码

* passwd 用户名：给指定用户名设置密码，切记:如果不写用户名则是给当前登录用户修改密码。

### 删除用户

* userdel 用户名 ：删除用户但是保留家目录
* userdel -r 用户名：删除用户和家目录。

### 查询用户

* id 用户名

### 切换用户

* su - 用户名：低等级用户转高等级用户需要输入密码，反正不需要。
* logout：退出当前用户返回上一层用户

### 查看当前用户

* whoami/who am i：查看的是登录用户的信息，不会被切换用户进行影响。
* hostname：查看当前主机名

## 用户组

​	类似于角色，系统可以对有共性/权限的多个用户进行统一的管理

### 新增组

* groupadd 组名

### 删除组

* groupdel 组名

### 新增用户时直接加上组

* useradd -g 用户组 用户名 

### 修改用户的组

* usermod -g 用户组 用户名

### 用户和组相关文件

* /etc/passwd文件：用户(user)的配置文件，记录用户的各种信息
  * 每行的含义:用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell
* /etc/shadow文件：口令配置文件
  * 每行含义: 登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志
* /etc/group文件：组(group)的配置文件，记录Linux包含的组的信息
  * 每行含义:组名:口令:组标识符:组内部用户列表

## 实用指令

### 指定运行级别

* 基本介绍

  * 0：关机

  * 1：单用户【找回密码】

  * 2：多用户状态没有网络服务【一般不用】

  * 3：多用户状态有网络服务

  * 4：系统未使用保留给用户

  * 5：图形界面

  * 6：系统重启

    常用运行级别时3和5，也可以指定默认运行级别

* multi-user.target:analogous to runlevel 3【3级别】

* graphical.target:analogous to runlevel 5【5级别】

* 使用systemctl get-default：查看当前运行级别

* 使用systemctl set-default：multi-user.target/graphical.target：修改默认运行级别

### 帮助指令

* man 获取帮助信息
  * man [命令或配置文件]（获取帮助信息）
* help指令
  * help 命令（获取shell内置命令的帮助信息） 

### 文件目录类

* pwd命令 ：显示当前工作目录的绝对路径
* ls 命令：
  * 基本语法：ls [选项] [目录或者文件]
  * -a：显示当前目录所有的文件和目录，包括隐藏的。
  * -l：以列表的方式显示信息
  * -h：文件的大小显示方式为能看懂
  * R：递归显示子目录中的内容
* cd指令：
  * 基本语法：cd [参数] （切换到指定目录）
  * cd ~或者cd ：回到自己的家目录
  * cd .. :返回上一层
* mkdir指令：用于创建目录
  * mkdir [选项] 要创建的目录
  * -p：创建多级目录
* rmdir：用于删除目录
  * rmdir [选项] 要删除的目录
  * 使用细节：rmdir删除的是空目录，如果目录下有内容时无法删除的。一般使用：rm -rf 要删除的目录
* touch指令：创建空文件
  * touch 文件名称
* cp指令： 拷贝文件袋指定目录
  * cp [选项] source dest 
  * -r :递归复制整个文件夹
  * 强制覆盖不提示的方法：\cp
* rm指令：移除文件或目录
  * rm [选项] 要删除的文件或目录
  * -r：递归删除整个文件夹
  * -f：强制删除不提示
* mv指令：移动文件与目录或重命名
  * mv 旧文件名 新文件名 （重命名）
  * mv 被移动文件的位置 移动到的位置 （移动文件）
* cat指令：查看文件内容
  * cat [选项] 要查看的内容
  * -n：显示行号
  * 为了方便浏览，一般会带上 管道命令 | more 
* more 指令：是一个基于vi编辑器的文本过滤器，它以全屏幕的方法按页显示文本文件的内容。more指令中内置了若干快捷键
  * more 要查看的文件
    * 按空格：向下翻一页；
    * 按回车：向下翻一行
    * 按q：离开more，不再显示该文件内容
    * 按Ctrl+F：向上滚动一屏
    * 按Ctrl+B：返回上一屏
    * =：输出当前行的行号
    * :f ：输出文件名和当前行的行号
* less指令：用来分屏查看文件内容，它的功能与more指令类似，但是比more指令更加的强大，支持各种显示终端，less指令在显示文件内容时，并不是以一次将整个文件加载之后才显示，而是根据显示需要加载的内容，对于显示大型文件具有较高的效率
  * less 查询的文件
    * 按空格：向下翻动一页；
    * 按[pagedown]：向下翻动一页；
    * 按[pageup]：向上翻动一页；
    * /字符串 ：向下搜寻【字符串】的功能，按n向下查找；按N向上查找
    * ?字符串：向上搜寻【字符串】的功能，按n向上查找；按N向下查找
    * q：退出less
* echo指令：输出内容到控制台
  * echo [选项] [输出的内容]
* head指令 ：用于显示文件的开头部分内容，默认情况下head指令显示文件的前10行内容
  * head 文件：查看文件的前10行内容
  * head -n 5 文件 ：显示文件的前5行内容，5可以时任意行数
* tail指令：用户输出文件尾部的内容，默认情况下tail指令显示文件的后10行内容
  * tail 文件 ：显示文件尾10行内容
  * tail -n 5 文件 ：显示文件尾5行内容，5可以是任意行数
  * tail -f 文件：实时追踪该文件的所有更新
* '>'指令 和‘>>’指令 ：'>'覆盖；'>>'追加
  * ls -l > 文件：将列表的内容写入到文件中，覆盖写
  * ls -al >> 文件：将列表的内容追加到文件的末尾
  * cat 文件1 > 文件2 ：将文件1的内容覆盖文件2中
  * echo “内容”  >> 文件 ：将引号中的内容追加到文件中
* ln指令：软链接也称为符号链接，类似于window里的快捷键方式，主要存放了链接文件的路径
  * ln -s [原文件或目录] [软链接名]（给原文件创建一个软链接）
  * 实例
    * Q:在/home目录下创建一个软链接，链接到/root目录
    * A:ln -s /root /home/myroot
    * Q:删除软链接myroot
    * A: rm -rf /home/myroot
* history指令：查看已经执行过历史命令，也可以执行历史命令
  * history (查看已经执行过的历史命令)
  * 执行之前的命令在命令编号前添加【!】
  * 实例
    * Q:显示所有的历史命令
    * A：history
    * Q:显示最近使用过的10个指令
    * A：history 10
    * Q:执行历史编号为5的指令
    * A：!5

### 时间日期类

* date指令：显示当前日期
  * date (显示当前时间)
  * date + %Y  (显示当前年份)
  * date + %m (显示当前月份)
  * date + %d (显示当前是哪一天）
  * date "+ %Y-%m-%d %H:%M:%S" (显示当前年月日时分秒)
  * date -s 字符串时间（设置日期）
  * 实例
    * Q：显示当前时间信息
    * A：date
    * Q：显示当前时间年月日
    * A：date "+%Y-%m-%d"
    * Q：显示当前时间年月日时分秒
    * A：date "+%Y-%m-%d %H:%M:%S"
* cal指令：查看日历指令 
  * cal [选项] （不加选项，显示本月日历）
  * 实例
    * Q：显示当前日历
    * A：cal
    * Q：显示2020年日历
    * A：cal 2020

### 搜索查询类

* find指令：将从指令目录向下递归地遍历其各个子目录，将满足条件的文件或目录显示在终端。
  * find [搜索范围] [选项]
    * -name<查询方法>：按照指定的文件名查找模式查找文件
    * -user<用户名>：查找属于指定用户名所有文件
    * -size<文件大小>：按照指定的文件大小查找文件
  * 案例
    * Q：按文件名：根据名称查找/home目录下的hello.txt文件
    * A：find /home -name hello.txt
    * Q：按拥有者：查找/opt目录下，用户名称为nobody的文件
    * A：find /opt -user nobody
    * Q：查找整个linux系统下大于200M的文件（+n大于 -n小于 n等于）
    * A：find / -size 200M
* locate指令：可以快速定位文件路径
  * locate 搜索文件
  * 说明：由于locate指令基于数据库进行查询，所以第一次执行前，必须使用updatedb指令创建locate数据库
  * 案例
    * Q：使用locate指令快速定位hello.txt文件目录
    * A：现进行updatedb，在执行locate hello.txt(如果显示未找到命令：先执行：yum install mlocate；安装locate)
* which指令：查看某个命令在那个目录下
  * which [选项]
  * 案例
    * Q：查看ls命令在那个目录下
    * A：which ls
* grep指令和管道符号|：grep锅炉查询，管道符，“|”，表示将前一个命令的处理结果输出传递给后面的命令处理。
  * grep [选项] 查找内容 原文件
    * -n：显示匹配行及行号
    * -i：忽略字母大小写
    * **-a 或 --text** : 不要忽略二进制的数据。
    * **-A<显示行数> 或 --after-context=<显示行数>** : 除了显示符合范本样式的那一列之外，并显示该行之后的内容。
    * **-b 或 --byte-offset** : 在显示符合样式的那一行之前，标示出该行第一个字符的编号。
    * **-B<显示行数> 或 --before-context=<显示行数>** : 除了显示符合样式的那一行之外，并显示该行之前的内容。
    * **-c 或 --count** : 计算符合样式的列数。
    * **-C<显示行数> 或 --context=<显示行数>或-<显示行数>** : 除了显示符合样式的那一行之外，并显示该行之前后的内容。
    * **-d <动作> 或 --directories=<动作>** : 当指定要查找的是目录而非文件时，必须使用这项参数，否则grep指令将回报信息并停止动作。
    * **-e<范本样式> 或 --regexp=<范本样式>** : 指定字符串做为查找文件内容的样式。
    * **-E 或 --extended-regexp** : 将样式为延伸的正则表达式来使用。
    * **-f<规则文件> 或 --file=<规则文件>** : 指定规则文件，其内容含有一个或多个规则样式，让grep查找符合规则条件的文件内容，格式为每行一个规则样式。
    * **-F 或 --fixed-regexp** : 将样式视为固定字符串的列表。
    * **-G 或 --basic-regexp** : 将样式视为普通的表示法来使用。
    * **-h 或 --no-filename** : 在显示符合样式的那一行之前，不标示该行所属的文件名称。
    * **-H 或 --with-filename** : 在显示符合样式的那一行之前，表示该行所属的文件名称。
    * **-i 或 --ignore-case** : 忽略字符大小写的差别。
    * **-l 或 --file-with-matches** : 列出文件内容符合指定的样式的文件名称。
    * **-L 或 --files-without-match** : 列出文件内容不符合指定的样式的文件名称。
    * **-n 或 --line-number** : 在显示符合样式的那一行之前，标示出该行的列数编号。
    * **-o 或 --only-matching** : 只显示匹配PATTERN 部分。
    * **-q 或 --quiet或--silent** : 不显示任何信息。
    * **-r 或 --recursive** : 此参数的效果和指定"-d recurse"参数相同。
    * **-s 或 --no-messages** : 不显示错误信息。
    * **-v 或 --invert-match** : 显示不包含匹配文本的所有行。
    * **-V 或 --version** : 显示版本信息。
    * **-w 或 --word-regexp** : 只显示全字符合的列。
    * **-x --line-regexp** : 只显示全列符合的列。
    * **-y** : 此参数的效果和指定"-i"参数相同
  * 实例
    * Q：请在hello.txt文件中，查找“yes”所在行，并且显示行号。
    * A1：grep -ni "yes" hello.txt
    * A2：cat hello.txt | grep -n "yes"

### 压缩和解压类

* gzip/gunzip指令：gzip用于压缩文件，gunzip用于解压的
  * gzip 文件（压缩文件，只能将文件压缩为*.gz文件）
  * gunzip 文件.gz（解压缩文件命令）
  * 实例
    * Q：将/home下的hello.txt文件进行压缩
    * A：gzip /home/hello.txt
    * Q：将/home下的hello.txt.gz文件进行解压缩
    * A：gunzip /home/hello.txt.gz
* zip/unzip指令：zip用于压缩文件，unzip用于解压
  * zip [选项] XXX.zip 将要压缩的文件（压缩文件和目录的命令）
    * -r：递归压缩，即压缩目录
  * unzip [选项] XXX.zip (解压缩文件)
    * -d<目录> ：指定解压后文件存放目录
  * 实例
    * Q：将/home下的所有文件进行压缩成myhome.zip
    * A：zip -r myhome.zip /home
    * Q：将myhome.zip 解压到/opt/tmp目录下
    * A：unzip -d /opt/tmp myhome.zip
* tar指令：打包命令
  * tar [选项] XXX.tar.gz 打包的内容 (打包目录，压缩后的文件格式.tar.gz)
    * -c：产生.tar打包文件
    * -v：显示详细信息
    * -f：指定压缩后的文件名
    * -z：打包同时压缩
    * -x：解包.tar文件
  * 实例
    * Q：压缩多个文件，将/home/pig.txt和/home/cat.txt压缩成pc.tar.gz
    * A：tar -zcvf pc.tar.gz /home/pig.txt /home/cat.txt
    * Q：将/home的文件夹压缩成myhome.tar.gz
    * A：tar -zcvf home.tar.gz /home
    * Q：将pc.tar.gz解压到当前文件夹
    * A：tar -zxvf pc.tar.gz
    * Q：将myhome.tar.gz 解压到/opt/tmp2目录下
    * A：tar -zxvf  myhome.tar.gz -C /opt/tmp2

### whereis 软件名称

* 查看软件安装的位置

## 权限指令

### 文件/目录 所有者

* chown指令：修改文件所有者
  * chown 用户名 文件名

### 组

* groupadd指令：创建组
  * groupadd 组名
* chgrp指令 ：修改文件所在的组
  * chgrp 组名 文件名 
* 其他组：除文件的所有者所在组的用户外，系统的其他用户都是文件的其他组
* 改变用户所在组
  * usermod -g 组名 用户名
  * usermod -d 目录名 用户名 改变该用户登录的初始目录

### 权限的基本介绍

* drwx------ 4 zwj  mojiao 4096 Mar  3 17:08 zwj
  * 0-9位说明
    1. 第0位确定文档的类型（d，-，l，c，b）
       * l是链接，相当于windows的快捷键
       * d是目录，相当于windows的文件夹
       * c是字符设备文件，鼠标、键盘
       * b是块设备，比如硬盘
       * -是文件
    2. 第1-3位确定所有者（该文件所有者）拥有该文件的权限。---User
    3. 第4-6位确定所属组（同用户组的）拥有该文件的权限。---Group
    4. 第7-9位确定其他拥有该文件的权限。---Other
  * r=4,w=2,x=1
  * 其他说明
    * 4：文件数+子目录数
    * zwj ：用户
    * mojiao ：组
    * 4069：文件大小(字节)，如果是文件夹，显示4096字节
    * Mar  3 17:08：最后修改时间
    * zwj：文件名或目录名
* rwx权限详解
  * rwx作用在文件
    1. [ r ]表示可读(read)：可以读取，查看
    2. [ w ]代表可写(write):可以修改，但是不代表可以删除该文件，删除一个文件的前提是对该文件所在目录有写权限，才能进行删除该文件。
    3. [ x ]代表可执行(execute):可以被执行
  * rwx作用到目录
    1. [ r ]表示可读(read)：可以读取，ls查看目录内容
    2. [ w ]代表可写(write):可以修改，对目录内创建+删除+重命名目录
    3. [ x ]代表可执行(execute):可以进入该目录

### 修改权限

* chmod指令：修改文件或目录的权限
  * 方式一：
    * +、-、=变更权限
    * u:所有者，g:所有组 o:其他人 a:所有人(u、g、o的总和)
    * chmod u=rwx,g=rx,o=r 文件/目录
    * chomd o+w 文件/目录
    * chomd a-x 文件/目录
  * 方式二：
    * r=4,w=2,x=1，rwx=7
    * chmod u=rwx,g=rx,o=r 文件/目录 相当于 chmod 751 文件/目录 
* chown指令：修改文件所有者
  * chown 新所有者 文件/目录 改变所有者
  * chown 新所有者:新所在组 文件/目录 改变所有者和所在组
    * -R 如果是目录，则使其下所有子文件或目录递归生效（必须大写）
* chgrp指令：修改文件/目录所在组
  * chgrp newgroup 文件/目录 改变所在组

## 定时任务调度

### crond 任务调度

* 概念：
  * 任务调度：是指系统在某个时间执行的特定的命令或程序
  * 任务调度分类：
    1. 系统工作：有些重要的工作必须周而复始地执行。如病毒扫描
    2. 个别用户工作：个别用户可能希望执行某些程序，比如对mysql数据库备份。
* crontab指令
  * crontab [选项]
    * -e：编辑crontab定时任务
    * -l：查询crontab任务
    * -r：删除当前用户所有的crontab任务
    * service crond restart [重启任务调度]
    
  * 实例：*/1 * * * * ls -l /etc/ > /tmp/to.txt

    | 项目     | 含义                 | 范围                |
    | -------- | -------------------- | ------------------- |
    | 第一个 * | 一小时当中的第几分钟 | 0-59                |
    | 第二个 * | 一天中第几个小时     | 0-23                |
    | 第三个 * | 一个月当中的第几天   | 0-31                |
    | 第四个 * | 一年当中的第几月     | 0-12                |
    | 第五个 * | 一周当中的星期几     | 0-7(0和7都是星期日) |

  * 特殊符号的说明

    | 特殊符号 | 含义                                                         |
    | -------- | ------------------------------------------------------------ |
    | *        | 代表任何时间，比如第一个“*”就表示一个小时中每分钟都执行一次的意思 |
    | .        | 表示不连续的时间。比如“0 8.12.16 * * *命令“，表示在每天的8点0分，12点0分，16点0分都执行一次命令 |
    | -        | 表示连续的时间范围。比如”0 5 * * 1-6 命令“，表示周一到周六的凌晨5点0分执行命令 |
    | */n      | 表示每隔多久执行一次。比如”*/n * * * * 命令“，表示每隔10分钟就执行一遍命令 |

### at定时任务

* at命令

  * at [选项] [时间]

    | **选项**      | **含义**                                                 |
    | ------------- | -------------------------------------------------------- |
    | -m            | 当指定的任务被完成后，将给用户发送邮件，即使没有标准输出 |
    | -I            | atq的别名                                                |
    | -d            | atrm的别名                                               |
    | -v            | 显示任务将被执行的时间                                   |
    | -c            | 打印任务的内容到标准输出                                 |
    | -V            | 显示版本信息                                             |
    | -q <队列>     | 使用指定的队列                                           |
    | -f <文件>     | 从指定文件读入任务而不是从标准输入读入                   |
    | -t <时间参数> | 以时间参数的形式提交要运行的任务                         |

    at允许使用一套相当复杂的指定时间的方法：

    ● 能够接受在当天的hh:mm（小时:分钟）式的时间指定。假如该时间已过去，那么就放在第二天执行。 例如：04:00
    ● 能够使用midnight（深夜），noon（中午），teatime（饮茶时间，一般是下午4点）等比较模糊的词语来指定时间。
    ● 能够采用12小时计时制，即在时间后面加上AM（上午）或PM（下午）来说明是上午还是下午。 例如：12pm
    ● 能够指定命令执行的具体日期，指定格式为month day（月 日）或mm/dd/yy（月/日/年）或dd.mm.yy（日.月.年），指定的日期必须跟在指定时间的后面。 例如：04:00 2009-03-1
    ● 能够使用相对计时法。指定格式为：now + count time-units ，now就是当前时间，time-units是时间单位，这里能够是minutes（分钟）、hours（小时）、days（天）、weeks（星期）。count是时间的数量，几天，几小时。 例如：now + 5 minutes 04pm + 3 days
    ● 能够直接使用today（今天）、tomorrow（明天）来指定完成命令的时间。
    
  * atq:查看系统没有执行的工作任务
  
  * atrm [编号] ：删除对应编号的任务
  
  * 实例
  
    * Q：2天后下午5点执行 /bin/ls /home
    * A：at 5pm +2 days 【按回车】 命令 【按ctrl+d】

## Linux分区

### 硬盘挂载

* 查看所有设备挂载情况
  * lsblk或者lsblk -f
* 分区命令
  * fdisk /dev/sdb
    * m：显示命令列表
    * p：显示磁盘分区
    * n：新增分区
    * d：删除分区
    * w：写入并退出
* 格式化磁盘
  * mkfs -t ext4 分区
    * ext4是分区类型
* 分区挂载
  * mount 分区 需要挂载的目录
  * umount 分区：卸载分区和目录之间的挂载
* 永久挂载
  * 修改/etc/fstab文件，添加完后执行mount -a立即生效

### 磁盘情况查询

* 查询整体磁盘使用情况
  * df -h
* 查询指定目录的磁盘占用情况
  * du -h 目录
    * -s：指定目录占用大小汇总
    * -h：带计量单位
    * -a：含文件
    * --max-depth=1 子目录深度
    * -c：列出明细的同时，增加汇总值
  * 实例
    * Q:查询/opt目录的磁盘占用情况，深度为1
    * A：du -ha --max-depth=1 /opt
* 磁盘工具实用指令
  1. 统计/opt文件夹下文件的个数
     * ll /opt | grep "^-" | wc -l  (wc -l：显示文件的个数)
  2. 统计/opt文件夹下目录的个数
     * ll /opt | grep "^d" | wc -l
  3. 统计/opt文件夹下文件的个数，包括子文件夹里的
     * ls -lR /opt | grep "^-" | wc -l
  4. 统计/opt文件夹下目录的个数，包括子文件夹里的
     * ls -lR /opt | grep "^d" | wc -l
  5. 以树状显示目录结构
     * 安装tree包：yum install tree
     * 使用：tree  目录

## 网络配置

### 网络指令

* ifconfig指令：查看linux的网络ip
* ping指令：测试与目标主机的连通性

### 主机名设置

* 修改/etc/hostname中的名称，修改后重启

## 进程

### 显示系统执行的进程

* ps指令：查看目前系统中有哪些正在执行的命令

  * -a：显示当前终端的所有进程信息

  * -u：以用户的格式显示进行信息

  * -x：显示后台进程运行的参数

  * -e：显示所有进程

  * -f：全格式

  * ps输出内容详解

    * ```shell
      USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND
      USER: 行程拥有者
      PID: pid：进程号
      %CPU: 占用的 CPU 使用率
      %MEM: 占用的物理内存使用率
      VSZ: 占用的虚拟内存大小（KB）
      RSS: 占用的物理内存体大小（KB）
      TTY: 终端的次要装置号码 (minor device number of tty)
      STAT: 该行程的状态:
      　　D: 不可中断的静止
      　　R: 正在执行中
      　　S: 静止状态
      　　T: 暂停执行
      　　Z: 不存在但暂时无法消除
      　　W: 没有足够的记忆体分页可分配
      　　<: 高优先序的行程
      　　N: 低优先序的行程
      　　L: 有记忆体分页分配并锁在记忆体内 (即时系统或捱A I/O)
      START: 行程开始时间
      TIME: 执行的时间
      COMMAND:所执行的指令
      ```

### 终止进程

* kill或killall指令：终止进程
  * kill [选项] 进程号（通过进程号终止进程）
  * killall 进程名称（通过进程名称终止进程，也支持通配符，这在系统因为负载过大变得很慢时很有用)
    * -9：强制进程立即停止

### 查看进程树

* pstree指令：更加直观的来看进程信息
  * pstree [选项]
    * -p：显示进程pid
    * -u：显示进程的所属用户

## 服务管理

* 介绍：服务本质就是进程，但是是运行在后台，通常都会监听某个端口，等待其它程序的请求，比如(mysqld,sshd,防火墙等)，因此我们又称为守护进程。

### Service管理指令

* service 服务名 [start | stop | restart | reload | status]
* 在centos7.0后很多服务不在使用service，而是systemctl
* service指令管理的服务在/etc/init.d查看
* 查看服务名：setup

### 服务的运行级别

| Linux系统有7个运行级别(runlevel)：常用的是级别3和5           |
| ------------------------------------------------------------ |
| 运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动 |
| 运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆 |
| 运行级别2：多用户状态(没有NFS)，不支持网络                   |
| 运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式 |
| 运行级别4：系统未使用，保留                                  |
| 运行级别5：X11控制台，登陆后进入图形GUI模式                  |
| 运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动 |

* multi-user.target:analogous to runlevel 3【3级别】
* graphical.target:analogous to runlevel 5【5级别】

* 使用systemctl get-default：查看当前运行级别

* 使用systemctl set-default：multi-user.target/graphical.target：修改默认运行级别

### chkconfig指令

* 介绍
  1. 通过chkconfig命令可以给服务的各个运行级别设置自 启动/关闭
  2. chkconfig指令管理的服务在/etc/init.d查看
* chkconfig基本语法
  * 查看服务 chkconfig --list [| grep xxx]
  * chkconfig 服务名 --list
  * chkconfig --level 5 服务名 on/off

### systemctl管理指令

* systemctl [start | stop | restart | status] 服务名
* systemctl指令管理的服务在/usr/lib/systemd/system查看

### systemctl是指服务的自启动状态

1. systemctl list-unit-files [|grep 服务名] （查看服务开机启动状态，grep可以进行过滤）
2. systemctl enable 服务名 (设置服务开机启动)
3. systemctl disable 服务名 (关闭服务开机启动)
4. systemctl is-enabled 服务名 (查看某个服务是否是自启动的)
5. telnet ip 端口：测试端口是否开通（win上使用）

### 打开或关闭某些端口

* firewall指令（防火墙） 
  * 打开端口：firewall-cmd --permannet --add-port=端口号/协议
  * 关闭端口：firewall-cmd --permannet --remove-port=端口号/协议
  * 重新载入，才能生效：firewall-cmd --reload
  * 查询端口是否开放：firewall-cmd --query-port=端口/协议 

## 动态监控

### top

* top [选项]
  * -d 秒数：指定top命令每隔几秒更新。默认是3秒
  * -i：使top不显示任何闲置或者僵死进程
  * -p：通过指定监控进程id来仅仅监控某个进程的状态

### 交互操作

* 在top命令后输入

  | 操作 | 功能                                                   |
  | ---- | ------------------------------------------------------ |
  | P    | 以CPU使用频率排序，默认就是此项                        |
  | M    | 以内存的使用率排序                                     |
  | N    | 以PID排序                                              |
  | q    | 退出top                                                |
  | u    | 输入u后，再输入用户名，查看对应用户名的进程            |
  | k    | 输入k后，再输入进程ID号，终止当前进程，可能需要再输入9 |

### 监控网络状态

### netstat指令

* netstat [选项]
  * -an：按一定顺序排序列输出
  * -p：显示哪个进程在调用

### 检测主机连接命令ping

* ping ip地址

## RPM和YUM功能

### RPM

* 介绍：rpm用于互联网下载包的打包及安装工具，它包含在某些Liunx分发版中。生成具有.RPM扩展名的文件。
* rpm包的简单查询命令
  * rpm -qa 查看所有的安装包，用grep进行过滤
  * rpm -qa | more ：分页查看
  * rpm -q 软件包名：查看软件包是否安装
  * rpm -qi 软件报名 ：查询软件包信息
  * rpm -ql 软件包名：查看软件包中的文件
  * rpm -qf 文件全路径名 :查询文件所属的软件包
* 卸载rpm包
  * rpm -e RPM包的名称  //【-e:erace】
    * --nodeps:强制删除
* 安装rpm包
  * rpm -ivh RPM包的全路径
    * i：install 安装
    * v：verbose 提示
    * h：hash 进度跳

### YUM

* yum是一个Shell前端软件包管理器。

* yum基本指令
  * 查询yum服务器是否有需要安装的软件
    * yum list | grep 软件名
  * 安装指定的yum包
    * yum install 软件名 ：下载安装

## Shell编程

### 脚本格式要求

1. 脚本以#!/bin/bash开头
2. 将本需要可执行权限

### 编写一个Shell脚本

* 需求说明：创建一个Shell脚本，输出hello world！

  ```shell
  #!/bin/bash
  echo "hello world!"
  ```

### 脚本的常用执行方式

* 方式一(输入脚本的相对路径或者绝对路径)：首先基于该脚本执行权限，在执行脚本:使用[./脚本]执行权限
* 方式二(sh+脚本)：不需要给脚本执行权限，在执行脚本使用[sh+脚本]

### Shell变量介绍

* 系统变量

  * $HOME、$PWD、$SHELL、$USER等
  * 显示当前shell中所有变量：set

* 自定义变量

  * 定义变量：变量名=值
  * 撤销变量：unset 变量
  * 声明静态变量：readonly变量，注意：静态变量不能撤销
  * 变量输出：$变量

* 变量的定义

  * 变量名可以又字母，数字，下划线组成，但是不能以数字开头。
  * 等号两侧不能有空格
  * 变量名称一般习惯为大写
  * 将命令的返回值赋给变量
    * A=`date`反引号，运行里面的命令，并吧结果返回给变量A
    * A=$(date)等价于反引号

* 多行注释

  * ```shell
    :<<!
    内容
    !
    ```

### 设置环境变量

* export 变量名=变量值 （将shell变量输出为环境变量/全局变量）
* source 配置文件 （让修改后的配置信息立即生效）
* echo $变量名 （查询环境变量的值）

### 位置参数变量

* 当我们执行一个shell脚本时，如果希望获取命令行的参数信息，就可以使用到位置参数变量
* 基本功能
  * $n：n为数字，$0代表命令本身，$1-$9代表第一到第九个参数，十以上的参数需要用大括号包含，如${ 10}
  * $*：这个变量代表命令行中所有的参数，`$*` 把所有的参数看成一个整体
  * $@：这个变量也代表命令行中所有的参数，不过$@把每个参数区分对待
  * $#：这个变量代表命令行中所有的参数的个数

### 预定义变量

* 就是shell设计者事先定以好的变量，可以直接在shell脚本中使用
* 基本语法
  * $$ :当前进程的进程号(PID)
  * $!:后台进行的最后一个进程的进程号
  * $?：最后一次执行的命令的返回状体，如果这个变量的值为0，证明上一个命令正确执行；如果这个变量的值为非0（具体是哪个数，由命令自己来决定），则证明上一个命令执行不正确了。

### 运算符

* 基本语法
  * $((运算式))或者$[运算式]或者expr m+n  //expression 表达式
  * 注意expr运算符之间要有空格，如果需要将expr的结果赋给某个变量，需要使用``
  * expr m - n
  * expr `\*`,/,% 乘，除，取余
